import{r as c}from"./index-C8OgQ19d.js";const g="http://localhost:3001",m=(t,e={})=>{const[s,o]=c.useState(null),[a,n]=c.useState(!0),[l,f]=c.useState(null),i=c.useRef(null),{immediate:h=!0,cacheTime:r=5*60*1e3,dependencies:u=[]}=e,d=c.useCallback(async()=>{try{n(!0),f(null),i.current&&i.current.abort(),i.current=new AbortController;const p=await fetch(`${g}${t}`,{signal:i.current.signal,credentials:"include",headers:{"Content-Type":"application/json"}});if(!p.ok)throw new Error(`HTTP error! status: ${p.status}`);const $=await p.json();o($)}catch(p){p.name!=="AbortError"&&(f(p),console.error("API Error:",p))}finally{n(!1)}},[t,...u]);return c.useEffect(()=>(h&&d(),()=>{i.current&&i.current.abort()}),[d,h]),{data:s,loading:a,error:l,refetch:d}},y=(t,e={})=>{const[s,o]=c.useState(!1),[a,n]=c.useState(null),[l,f]=c.useState(null);return{execute:c.useCallback(async(h={})=>{try{o(!0),n(null);const r=await fetch(`${g}${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...e.headers},body:JSON.stringify(h)});if(!r.ok){const d=await r.json();throw new Error(d.error||`HTTP error! status: ${r.status}`)}const u=await r.json();return f(u),{success:!0,data:u}}catch(r){return n(r),console.error("POST Error:",r),{success:!1,error:r.message}}finally{o(!1)}},[t,e.headers]),loading:s,error:a,data:l}},P=(t,e={})=>{const[s,o]=c.useState(!1),[a,n]=c.useState(null),[l,f]=c.useState(null);return{execute:c.useCallback(async(h={})=>{try{o(!0),n(null);const r=await fetch(`${g}${t}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",...e.headers},body:JSON.stringify(h)});if(!r.ok){const d=await r.json();throw new Error(d.error||`HTTP error! status: ${r.status}`)}const u=await r.json();return f(u),{success:!0,data:u}}catch(r){return n(r),console.error("PUT Error:",r),{success:!1,error:r.message}}finally{o(!1)}},[t,e.headers]),loading:s,error:a,data:l}},S=(t,e={})=>{const[s,o]=c.useState(!1),[a,n]=c.useState(null),[l,f]=c.useState(null);return{execute:c.useCallback(async(h={})=>{try{o(!0),n(null);const r=await fetch(`${g}${t}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json",...e.headers},body:JSON.stringify(h)});if(!r.ok){const d=await r.json();throw new Error(d.error||`HTTP error! status: ${r.status}`)}const u=await r.json();return f(u),{success:!0,data:u}}catch(r){return n(r),console.error("DELETE Error:",r),{success:!1,error:r.message}}finally{o(!1)}},[t,e.headers]),loading:s,error:a,data:l}},w=(t=!1)=>{const{data:e,loading:s,error:o,refetch:a}=m(`/api/posts?drafts=${t}`,{immediate:!0});return{posts:(e==null?void 0:e.data)||[],loading:s,error:o,refetch:a,count:(e==null?void 0:e.count)||0}},E=t=>{const{data:e,loading:s,error:o,refetch:a}=m(t?`/api/posts/${t}`:null,{immediate:!!t});return{post:(e==null?void 0:e.data)||null,loading:s,error:o,refetch:a}},b=()=>y("/api/posts"),D=t=>P(`/api/posts/${t}`),C=t=>S(`/api/posts/${t}`),T=t=>P(`/api/posts/${t}/publish`),v=t=>{const e=y(`/api/posts/${t}/vote`),s=S(`/api/posts/${t}/vote`),o=c.useCallback(async(n,l)=>await e.execute({user_id:n,vote_type:l}),[e]),a=c.useCallback(async n=>await s.execute({user_id:n}),[s]);return{vote:o,unvote:a,loading:e.loading||s.loading,error:e.error||s.error}},x=(t,e)=>{var l;const{data:s,loading:o,error:a,refetch:n}=m(t&&e?`/api/posts/${t}/vote/${e}`:null,{immediate:!!(t&&e)});return{userVote:((l=s==null?void 0:s.data)==null?void 0:l.vote_type)||null,loading:o,error:a,refetch:n}},k=t=>{const{data:e,loading:s,error:o,refetch:a}=m(t?`/api/posts/${t}/comments`:null,{immediate:!!t});return{comments:(e==null?void 0:e.data)||[],loading:s,error:o,refetch:a,count:(e==null?void 0:e.count)||0}},L=t=>y(`/api/posts/${t}/comments`),A=t=>{const e=y(`/api/posts/${t}/share`);return{share:c.useCallback(async(o,a="link")=>await e.execute({user_id:o,share_type:a}),[e]),loading:e.loading,error:e.error}},j=t=>{const{data:e,loading:s,error:o,refetch:a}=m(t?`/api/posts/${t}/shares`:null,{immediate:!!t});return{shareStats:(e==null?void 0:e.data)||[],loading:s,error:o,refetch:a}},V=(t,e)=>{const{post:s,loading:o,error:a,refetch:n}=E(t),{comments:l,loading:f,refetch:i}=k(t),{userVote:h,refetch:r}=x(t,e),{shareStats:u,refetch:d}=j(t),p=c.useCallback(()=>{n(),i(),r(),d()},[n,i,r,d]);return{post:s,comments:l,userVote:h,shareStats:u,loading:o||f,error:a,refetchAll:p}},O=t=>{const{posts:e,loading:s,error:o,refetch:a}=w(!0),n=b(),l=D(),f=T(),i=C(),h=e.filter(u=>u.is_draft&&u.author_id===t),r=c.useCallback(async u=>await n.execute({...u,is_draft:!0}),[n]);return{drafts:h,loading:s,error:o,refetch:a,saveDraft:r,updateDraft:l.execute,publishDraft:f.execute,deleteDraft:i.execute}};export{O as a,V as b,v as c,L as d,A as e,b as u};
