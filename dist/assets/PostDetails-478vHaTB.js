import{c as H,a as I,u as M,r as E,R as e,b as T,L as G,B as n}from"./index-C8OgQ19d.js";import{b as J,c as W,d as q,e as K}from"./useApi-CDCt5oBc.js";const X=()=>{var k,j;const{id:m}=H(),v=I(),{user:l,isAuthenticated:c}=M(),[i,y]=E.useState(""),[N,p]=E.useState(null),[d,h]=E.useState(""),{post:r,comments:x,userVote:g,loading:L,error:R,refetchAll:u}=J(m,l==null?void 0:l.id),{vote:D,unvote:$,loading:w}=W(m),{execute:C,loading:b}=q(m),{share:F,loading:z}=K(m),_=async t=>{if(!c){n.error("Please login to vote");return}try{g===t?(await $(l.id),n.success("Vote removed")):(await D(l.id,t),n.success(`${t==="upvote"?"Upvoted":"Downvoted"} successfully`)),u()}catch{n.error("Failed to record vote")}},A=async t=>{if(t.preventDefault(),!c||!i.trim()){n.error("Please login and enter a comment");return}try{await C({author:l.id,content:i.trim(),parent_comment_id:null}),y(""),n.success("Comment posted successfully"),u()}catch{n.error("Failed to post comment")}},U=async t=>{if(!c||!d.trim()){n.error("Please login and enter a reply");return}try{await C({author:l.id,content:d.trim(),parent_comment_id:t}),h(""),p(null),n.success("Reply posted successfully"),u()}catch{n.error("Failed to post reply")}},V=async(t="link")=>{if(!c){n.error("Please login to share");return}try{if(t==="link"){const s=`${window.location.origin}/post/${m}`;await navigator.clipboard.writeText(s),n.success("Link copied to clipboard!")}await F(l.id,t),u()}catch{n.error("Failed to share post")}},f=t=>{const s=new Date(t),a=(new Date-s)/(1e3*60*60);return a<1?"Just now":a<24?`${Math.floor(a)}h ago`:a<168?`${Math.floor(a/24)}d ago`:s.toLocaleDateString()},B=x.reduce((t,s)=>{if(!s.parent_comment_id)t.push({...s,replies:[]});else{const o=t.find(a=>a.id===s.parent_comment_id);o&&o.replies.push(s)}return t},[]);return L?e.createElement("div",{className:"min-h-screen pt-20 flex items-center justify-center"},e.createElement(T,{size:"lg",text:"Loading post..."})):R||!r?e.createElement("div",{className:"min-h-screen pt-20 flex items-center justify-center"},e.createElement("div",{className:"text-center"},e.createElement("h2",{className:"text-2xl font-bold text-gray-900 mb-4"},"Post not found"),e.createElement("p",{className:"text-gray-600 mb-6"},"The post you're looking for doesn't exist."),e.createElement("button",{onClick:()=>v("/"),className:"btn-primary px-6 py-2"},"Go Home"))):e.createElement("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100"},e.createElement("nav",{className:"fixed top-0 left-0 right-0 z-50 bg-white/80 backdrop-blur-xl border-b border-white/20"},e.createElement("div",{className:"max-w-4xl mx-auto px-4 py-3"},e.createElement("div",{className:"flex items-center justify-between"},e.createElement("button",{onClick:()=>v(-1),className:"flex items-center space-x-2 px-4 py-2 rounded-full bg-gradient-to-r from-purple-400/20 to-blue-400/20 hover:scale-105 transition-all duration-200"},e.createElement("span",null,"â†"),e.createElement("span",{className:"font-medium text-gray-900"},"Back")),e.createElement("div",{className:"flex items-center space-x-4"},e.createElement("button",{onClick:()=>V("link"),disabled:z,className:"flex items-center space-x-2 px-4 py-2 rounded-full bg-gradient-to-r from-green-400/20 to-teal-400/20 hover:scale-105 transition-all duration-200 disabled:opacity-50"},e.createElement("span",null,"ðŸ”—"),e.createElement("span",{className:"font-medium text-gray-900"},"Share")))))),e.createElement("main",{className:"pt-20 pb-24 px-4 max-w-4xl mx-auto"},e.createElement("div",{className:"glass-card rounded-2xl p-6 mb-6 animate-glass-fade-in"},e.createElement("h1",{className:"text-3xl font-bold text-gray-900 mb-4 leading-tight"},r.title),e.createElement("div",{className:"flex items-center justify-between mb-6"},e.createElement("div",{className:"flex items-center space-x-4"},e.createElement("div",{className:"w-12 h-12 rounded-full bg-gradient-to-r from-purple-400 to-blue-400 flex items-center justify-center text-white font-bold text-lg"},((j=(k=r.author_name)==null?void 0:k[0])==null?void 0:j.toUpperCase())||"?"),e.createElement("div",null,e.createElement("div",{className:"flex items-center space-x-2"},e.createElement("span",{className:"font-semibold text-gray-900"},r.author_name)),e.createElement("div",{className:"flex items-center space-x-2 text-sm text-gray-600"},e.createElement("span",null,f(r.created_at)),r.is_draft&&e.createElement(e.Fragment,null,e.createElement("span",null,"â€¢"),e.createElement("span",{className:"text-orange-600 font-medium"},"Draft")))))),e.createElement("div",{className:"flex items-center justify-between"},e.createElement("div",{className:"flex items-center space-x-6"},e.createElement("div",{className:"flex items-center space-x-2"},e.createElement("button",{onClick:()=>_("upvote"),disabled:w,className:`vote-button ${g==="upvote"?"bg-green-500 text-white":"bg-white/50 text-gray-700 hover:bg-green-100"} disabled:opacity-50`},"â†‘"),e.createElement("span",{className:"font-bold text-lg text-gray-900"},(r.upvotes||0)-(r.downvotes||0)),e.createElement("button",{onClick:()=>_("downvote"),disabled:w,className:`vote-button ${g==="downvote"?"bg-red-500 text-white":"bg-white/50 text-gray-700 hover:bg-red-100"} disabled:opacity-50`},"â†“")),e.createElement("div",{className:"flex items-center space-x-2 text-gray-600"},e.createElement("span",null,"ðŸ’¬"),e.createElement("span",null,r.comment_count||0," comments")),e.createElement("div",{className:"flex items-center space-x-2 text-gray-600"},e.createElement("span",null,"ðŸ”—"),e.createElement("span",null,r.share_count||0," shares"))))),e.createElement("div",{className:"glass-card rounded-2xl p-6 mb-6 animate-slide-up"},e.createElement("div",{className:"prose prose-lg max-w-none"},e.createElement("div",{className:"whitespace-pre-wrap text-gray-800 leading-relaxed"},r.content))),e.createElement("div",{className:"glass-card rounded-2xl p-6 animate-slide-up"},e.createElement("h3",{className:"text-xl font-bold text-gray-900 mb-6 flex items-center"},e.createElement("span",{className:"mr-2"},"ðŸ’¬"),"Comments (",x.length,")"),c?e.createElement("form",{onSubmit:A,className:"mb-8"},e.createElement("div",{className:"glass-card-secondary rounded-xl p-4 mb-4"},e.createElement("textarea",{value:i,onChange:t=>y(t.target.value),placeholder:"Share your thoughts...",className:"w-full bg-transparent border-none outline-none resize-none text-gray-900 placeholder-gray-500",rows:"3"})),e.createElement("div",{className:"flex justify-end"},e.createElement("button",{type:"submit",disabled:!i.trim()||b,className:"btn-primary px-6 py-2 disabled:opacity-50"},b?"Posting...":"Post Comment"))):e.createElement("div",{className:"mb-8 p-4 rounded-xl bg-gray-100 text-center"},e.createElement("p",{className:"text-gray-600"},e.createElement(G,{to:"/login",className:"text-purple-600 hover:underline"},"Login")," to post a comment")),e.createElement("div",{className:"space-y-6"},B.map(t=>{var s,o;return e.createElement("div",{key:t.id,className:"comment-card rounded-xl p-4"},e.createElement("div",{className:"flex items-center justify-between mb-3"},e.createElement("div",{className:"flex items-center space-x-3"},e.createElement("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-blue-400 to-purple-400 flex items-center justify-center text-white font-bold text-sm"},((o=(s=t.author_name)==null?void 0:s[0])==null?void 0:o.toUpperCase())||"?"),e.createElement("span",{className:"font-medium text-gray-900"},t.author_name),e.createElement("span",{className:"text-sm text-gray-500"},f(t.created_at))),e.createElement("div",{className:"flex items-center space-x-2"},e.createElement("button",{className:"vote-button bg-white/50 text-gray-700 hover:bg-green-100 text-sm"},"â†‘ ",t.upvotes||0),e.createElement("button",{className:"vote-button bg-white/50 text-gray-700 hover:bg-red-100 text-sm"},"â†“ ",t.downvotes||0))),e.createElement("p",{className:"text-gray-800 mb-3 leading-relaxed"},t.content),e.createElement("div",{className:"flex items-center space-x-4"},c&&e.createElement("button",{onClick:()=>p(N===t.id?null:t.id),className:"text-sm text-purple-600 hover:text-purple-800 font-medium"},"Reply")),N===t.id&&e.createElement("div",{className:"mt-4 ml-6"},e.createElement("div",{className:"glass-card-secondary rounded-xl p-3 mb-3"},e.createElement("textarea",{value:d,onChange:a=>h(a.target.value),placeholder:"Write a reply...",className:"w-full bg-transparent border-none outline-none resize-none text-gray-900 placeholder-gray-500",rows:"2"})),e.createElement("div",{className:"flex justify-end space-x-2"},e.createElement("button",{onClick:()=>p(null),className:"btn-secondary px-4 py-1 text-sm"},"Cancel"),e.createElement("button",{onClick:()=>U(t.id),disabled:!d.trim()||b,className:"btn-primary px-4 py-1 text-sm disabled:opacity-50"},"Reply"))),t.replies&&t.replies.length>0&&e.createElement("div",{className:"mt-4 ml-6 space-y-4"},t.replies.map(a=>{var P,S;return e.createElement("div",{key:a.id,className:"comment-card rounded-xl p-3 bg-gray-50/50"},e.createElement("div",{className:"flex items-center justify-between mb-2"},e.createElement("div",{className:"flex items-center space-x-2"},e.createElement("div",{className:"w-6 h-6 rounded-full bg-gradient-to-r from-green-400 to-blue-400 flex items-center justify-center text-white font-bold text-xs"},((S=(P=a.author_name)==null?void 0:P[0])==null?void 0:S.toUpperCase())||"?"),e.createElement("span",{className:"font-medium text-gray-900 text-sm"},a.author_name),e.createElement("span",{className:"text-xs text-gray-500"},f(a.created_at))),e.createElement("div",{className:"flex items-center space-x-1"},e.createElement("button",{className:"vote-button bg-white/50 text-gray-700 hover:bg-green-100 text-xs"},"â†‘ ",a.upvotes||0),e.createElement("button",{className:"vote-button bg-white/50 text-gray-700 hover:bg-red-100 text-xs"},"â†“ ",a.downvotes||0))),e.createElement("p",{className:"text-gray-800 text-sm leading-relaxed"},a.content))})))}),x.length===0&&e.createElement("div",{className:"text-center py-8"},e.createElement("p",{className:"text-gray-500"},"No comments yet. Be the first to comment!"))))))};export{X as default};
