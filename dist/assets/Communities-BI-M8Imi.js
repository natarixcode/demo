import{u as F,a as T,r as l,R as e,L as S,B as A,b as I}from"./index-C8OgQ19d.js";const D=({community:s,userLocation:x,onJoinStatusChange:p})=>{const{user:f,isAuthenticated:w,getAuthHeader:v}=F(),M=T(),[y,C]=l.useState(!1),[d,$]=l.useState(s.member_count||0),[b,_]=l.useState(s.is_member||!1),[N,r]=l.useState(!1),G=()=>{if(!x||!s.latitude||!s.longitude)return null;const o=6371,u=(s.latitude-x.lat)*Math.PI/180,i=(s.longitude-x.lng)*Math.PI/180,g=Math.sin(u/2)*Math.sin(u/2)+Math.cos(x.lat*Math.PI/180)*Math.cos(s.latitude*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2),P=2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)),c=o*P;return c<1?`${Math.round(c*1e3)}m away`:c<10?`${c.toFixed(1)}km away`:`${Math.round(c)}km away`},m=async()=>{if(!w){A.error("Please login to join communities"),M("/login");return}if(y)return;C(!0);const o=b?"leave":"join";try{const u=await fetch(`http://localhost:3001/api/communities/${s.id}/${o}`,{method:"POST",headers:{"Content-Type":"application/json",...v()},body:JSON.stringify({user_id:f.id})});if(u.ok){const i=!b;_(i),$(g=>i?g+1:Math.max(0,g-1)),A.success(i?`🎉 Welcome to ${s.name}!`:`👋 Left ${s.name}`),p&&p(s.id,i?"joined":"left")}else{const i=await u.json();A.error(i.error||`Failed to ${o} community`)}}catch(u){console.error(`Error ${o}ing community:`,u),A.error(`Network error while trying to ${o} community`)}finally{C(!1)}},k=()=>s.type==="location_bound"?{icon:"📍",label:"Location-Based",bgColor:"from-iosGreen/10 to-iosTeal/10",textColor:"text-iosGreen",borderColor:"border-iosGreen/20"}:{icon:"🌐",label:"Global",bgColor:"from-iosBlue/10 to-iosPurple/10",textColor:"text-iosBlue",borderColor:"border-iosBlue/20"},j=()=>d>=1e6?`${(d/1e6).toFixed(1)}M`:d>=1e3?`${(d/1e3).toFixed(1)}K`:d.toString(),h=k(),B=G(),L=s.post_count||0;return e.createElement("div",{className:`group relative bg-white/70 backdrop-blur-md rounded-2xl border border-white/20 shadow-glass-sm hover:shadow-ios-lg transition-all duration-300 overflow-hidden ${N?"scale-[1.02]":""}`,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1)},e.createElement("div",{className:"absolute inset-0 bg-gradient-to-br from-white/30 via-transparent to-transparent opacity-50"}),e.createElement("div",{className:"relative p-6 pb-4"},e.createElement("div",{className:"flex items-start justify-between mb-4"},e.createElement("div",{className:"flex-1 min-w-0"},e.createElement(S,{to:`/communities/${s.id}`,className:"group/link"},e.createElement("h3",{className:"text-xl font-bold text-iosGray-900 mb-2 group-hover/link:text-iosBlue transition-colors duration-200 line-clamp-1"},s.name)),e.createElement("p",{className:"text-iosGray-600 text-sm line-clamp-2 mb-3 leading-relaxed"},s.description||"A wonderful community to connect and share."),e.createElement("div",{className:`inline-flex items-center space-x-2 px-3 py-1 bg-gradient-to-r ${h.bgColor} border ${h.borderColor} rounded-full`},e.createElement("span",{className:"text-sm"},h.icon),e.createElement("span",{className:`text-xs font-medium ${h.textColor}`},h.label))),b&&e.createElement("div",{className:"flex-shrink-0 ml-3"},e.createElement("div",{className:"w-8 h-8 bg-gradient-to-br from-iosGreen to-iosTeal rounded-full flex items-center justify-center shadow-ios"},e.createElement("span",{className:"text-white text-sm"},"✓")))),s.type==="location_bound"&&e.createElement("div",{className:"flex items-center space-x-4 text-xs text-iosGray-500 mb-4"},e.createElement("div",{className:"flex items-center space-x-1"},e.createElement("span",null,"📍"),e.createElement("span",{className:"truncate"},s.location||"Location-based community")),B&&e.createElement("div",{className:"flex items-center space-x-1"},e.createElement("span",null,"📏"),e.createElement("span",{className:"text-iosBlue font-medium"},B))),e.createElement("div",{className:"flex items-center justify-between text-sm"},e.createElement("div",{className:"flex items-center space-x-4"},e.createElement("div",{className:"flex items-center space-x-1 text-iosGray-600"},e.createElement("span",null,"👥"),e.createElement("span",{className:"font-medium"},j()),e.createElement("span",{className:"hidden sm:inline"},"members")),e.createElement("div",{className:"flex items-center space-x-1 text-iosGray-600"},e.createElement("span",null,"📝"),e.createElement("span",{className:"font-medium"},L),e.createElement("span",{className:"hidden sm:inline"},"posts")),e.createElement("div",{className:"flex items-center space-x-1"},e.createElement("div",{className:"w-2 h-2 bg-iosGreen rounded-full animate-pulse"}),e.createElement("span",{className:"text-xs text-iosGreen font-medium"},"Active"))))),e.createElement("div",{className:"relative p-6 pt-0"},e.createElement("div",{className:"flex items-center justify-between"},e.createElement(S,{to:`/communities/${s.id}`,className:"flex items-center space-x-2 px-4 py-2 bg-white/40 backdrop-blur-md text-iosGray-700 rounded-xl font-medium hover:bg-white/60 transition-all duration-200 border border-white/30"},e.createElement("span",null,"👀"),e.createElement("span",null,"View")),e.createElement("button",{onClick:m,disabled:y,className:`flex items-center space-x-2 px-4 py-2 rounded-xl font-semibold transition-all duration-200 shadow-ios disabled:opacity-50 disabled:cursor-not-allowed ${b?"bg-iosGray-200 text-iosGray-700 hover:bg-iosGray-300":"bg-iosBlue text-white hover:bg-iosBlue/90"}`},y?e.createElement(e.Fragment,null,e.createElement("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),e.createElement("span",null,"...")):b?e.createElement(e.Fragment,null,e.createElement("span",null,"✓"),e.createElement("span",null,"Joined")):e.createElement(e.Fragment,null,e.createElement("span",null,"+"),e.createElement("span",null,"Join")))),b&&e.createElement("div",{className:"flex items-center justify-center mt-3 pt-3 border-t border-white/20"},e.createElement(S,{to:`/communities/${s.id}/create-post`,className:"flex items-center space-x-2 px-3 py-1.5 bg-gradient-to-r from-iosBlue/10 to-iosPurple/10 text-iosBlue rounded-lg text-sm font-medium hover:from-iosBlue/20 hover:to-iosPurple/20 transition-all duration-200"},e.createElement("span",null,"✍️"),e.createElement("span",null,"Create Post")))),e.createElement("div",{className:`absolute inset-0 bg-gradient-to-br from-iosBlue/5 to-iosPurple/5 rounded-2xl transition-opacity duration-300 pointer-events-none ${N?"opacity-100":"opacity-0"}`}))},O=()=>{const{user:s,getAuthHeader:x}=F(),[p,f]=l.useState([]),[w,v]=l.useState(new Set),[M,y]=l.useState(!0),[C,d]=l.useState(""),[$,b]=l.useState(null),[_,N]=l.useState("prompt"),[r,G]=l.useState(""),[m,k]=l.useState("all"),[j,h]=l.useState("newest"),B=[{id:"all",label:"All Communities",icon:"🌍"},{id:"location_bound",label:"Location-Based",icon:"📍"},{id:"agnostic",label:"Global",icon:"🌐"},{id:"joined",label:"My Communities",icon:"⭐"}],L=[{id:"newest",label:"Newest First"},{id:"members",label:"Most Members"},{id:"name",label:"Alphabetical"},{id:"activity",label:"Most Active"}],o=async()=>{try{y(!0),d("");const t=await fetch("http://localhost:3001/api/communities",{method:"GET",headers:{"Content-Type":"application/json",...x()}});if(!t.ok)throw new Error(`Failed to fetch communities: ${t.status}`);const a=await t.json();console.log("Communities API response:",a),a.success&&Array.isArray(a.data)?f(a.data):Array.isArray(a)?f(a):a.communities&&Array.isArray(a.communities)?f(a.communities):(console.error("Communities data format unexpected:",a),f([]),d("Invalid data format received from server"))}catch(t){console.error("Error fetching communities:",t),d("Failed to load communities. Please try again."),f([])}finally{y(!1)}},u=async()=>{if(s!=null&&s.id)try{const t=await fetch("http://localhost:3001/api/communities/my",{method:"GET",headers:{"Content-Type":"application/json",...x()}});if(t.ok){const a=await t.json();console.log("User communities response:",a);let n=[];a.success&&Array.isArray(a.data)?n=a.data:Array.isArray(a)?n=a:a.communities&&Array.isArray(a.communities)&&(n=a.communities);const E=new Set(n.map(J=>J.id));v(E)}}catch(t){console.error("Error fetching joined communities:",t)}},i=(t,a)=>{a==="joined"?v(n=>new Set([...n,t])):a==="left"&&v(n=>{const E=new Set(n);return E.delete(t),E}),o()},g=()=>{if(!navigator.geolocation){N("denied");return}navigator.geolocation.getCurrentPosition(t=>{b({lat:t.coords.latitude,lng:t.coords.longitude}),N("granted")},t=>{console.error("Error getting location:",t),N("denied")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},P=()=>{let t=[...p];return r.trim()&&(t=t.filter(a=>{var n,E;return a.name.toLowerCase().includes(r.toLowerCase())||((n=a.description)==null?void 0:n.toLowerCase().includes(r.toLowerCase()))||((E=a.location)==null?void 0:E.toLowerCase().includes(r.toLowerCase()))})),m==="location_bound"?t=t.filter(a=>a.type==="location_bound"):m==="agnostic"?t=t.filter(a=>a.type==="agnostic"):m==="joined"&&(t=t.filter(a=>w.has(a.id))),t.sort((a,n)=>{switch(j){case"members":return(n.member_count||0)-(a.member_count||0);case"name":return a.name.localeCompare(n.name);case"activity":return(n.post_count||0)-(a.post_count||0);case"newest":default:return new Date(n.created_at)-new Date(a.created_at)}}),t};l.useEffect(()=>{o(),g()},[]),l.useEffect(()=>{s?u():v(new Set)},[s]);const c=P();return e.createElement("div",{className:"min-h-screen bg-gradient-to-br from-iosGray-50 via-white to-iosGray-100"},e.createElement("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},e.createElement("div",{className:"mb-8 animate-fade-in"},e.createElement("div",{className:"bg-white/70 backdrop-blur-md rounded-2xl border border-white/20 shadow-glass-sm p-6"},e.createElement("div",{className:"flex flex-col md:flex-row md:items-center justify-between"},e.createElement("div",{className:"mb-4 md:mb-0"},e.createElement("h1",{className:"text-3xl font-bold text-iosGray-900 mb-2"},"Discover Communities"),e.createElement("p",{className:"text-iosGray-600"},"Find your tribe and connect with like-minded people around the world")),s&&e.createElement(S,{to:"/create-community",className:"flex items-center space-x-2 px-6 py-3 bg-iosBlue text-white rounded-xl font-semibold hover:bg-iosBlue/90 transition-all duration-200 shadow-ios"},e.createElement("span",null,"➕"),e.createElement("span",null,"Create Community"))))),e.createElement("div",{className:"mb-8 animate-slide-up"},e.createElement("div",{className:"bg-white/70 backdrop-blur-md rounded-2xl border border-white/20 shadow-glass-sm p-6"},e.createElement("div",{className:"flex flex-col lg:flex-row gap-6"},e.createElement("div",{className:"flex-1"},e.createElement("div",{className:"relative"},e.createElement("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},e.createElement("span",{className:"text-iosGray-400 text-lg"},"🔍")),e.createElement("input",{type:"text",placeholder:"Search communities by name, description, or location...",value:r,onChange:t=>G(t.target.value),className:"w-full pl-10 pr-4 py-3 bg-white/60 border border-white/30 rounded-xl focus:ring-2 focus:ring-iosBlue/30 focus:border-iosBlue/50 transition-all duration-200 placeholder-iosGray-500"}))),e.createElement("div",{className:"flex flex-col sm:flex-row gap-4"},e.createElement("div",{className:"min-w-[200px]"},e.createElement("select",{value:m,onChange:t=>k(t.target.value),className:"w-full px-4 py-3 bg-white/60 border border-white/30 rounded-xl focus:ring-2 focus:ring-iosBlue/30 focus:border-iosBlue/50 transition-all duration-200"},B.map(t=>e.createElement("option",{key:t.id,value:t.id},t.icon," ",t.label)))),e.createElement("div",{className:"min-w-[180px]"},e.createElement("select",{value:j,onChange:t=>h(t.target.value),className:"w-full px-4 py-3 bg-white/60 border border-white/30 rounded-xl focus:ring-2 focus:ring-iosBlue/30 focus:border-iosBlue/50 transition-all duration-200"},L.map(t=>e.createElement("option",{key:t.id,value:t.id},t.label)))))),e.createElement("div",{className:"flex flex-wrap gap-2 mt-4"},B.map(t=>e.createElement("button",{key:t.id,onClick:()=>k(t.id),className:`flex items-center space-x-2 px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 ${m===t.id?"bg-iosBlue text-white shadow-ios":"bg-white/40 text-iosGray-700 hover:bg-white/60"}`},e.createElement("span",null,t.icon),e.createElement("span",null,t.label),t.id==="joined"&&w.size>0&&e.createElement("span",{className:"bg-white/30 px-2 py-0.5 rounded-full text-xs"},w.size)))))),e.createElement("div",{className:"animate-slide-up",style:{animationDelay:"0.1s"}},M?e.createElement("div",{className:"bg-white/70 backdrop-blur-md rounded-2xl border border-white/20 shadow-glass-sm p-12 text-center"},e.createElement(I,{size:"lg",text:"Loading communities..."})):C?e.createElement("div",{className:"bg-white/70 backdrop-blur-md rounded-2xl border border-white/20 shadow-glass-sm p-12 text-center"},e.createElement("div",{className:"text-6xl mb-4"},"😔"),e.createElement("h3",{className:"text-xl font-semibold text-iosGray-900 mb-2"},"Something went wrong"),e.createElement("p",{className:"text-iosGray-600 mb-6"},C),e.createElement("button",{onClick:o,className:"px-6 py-3 bg-iosBlue text-white rounded-xl font-semibold hover:bg-iosBlue/90 transition-all duration-200 shadow-ios"},"Try Again")):c.length===0?e.createElement("div",{className:"bg-white/70 backdrop-blur-md rounded-2xl border border-white/20 shadow-glass-sm p-12 text-center"},e.createElement("div",{className:"text-6xl mb-4"},r.trim()?"🔍":m==="joined"?"⭐":"🏘️"),e.createElement("h3",{className:"text-xl font-semibold text-iosGray-900 mb-2"},r.trim()?"No communities found":m==="joined"?"No joined communities":"No communities yet"),e.createElement("p",{className:"text-iosGray-600 mb-6"},r.trim()?"Try adjusting your search terms or filters":m==="joined"?"Join some communities to see them here":"Be the first to create a community!"),s&&e.createElement("div",{className:"flex flex-col sm:flex-row gap-3 justify-center"},e.createElement(S,{to:"/create-community",className:"px-6 py-3 bg-iosBlue text-white rounded-xl font-semibold hover:bg-iosBlue/90 transition-all duration-200 shadow-ios"},"Create Community"),r.trim()&&e.createElement("button",{onClick:()=>G(""),className:"px-6 py-3 bg-white/70 backdrop-blur-md text-iosGray-700 rounded-xl font-semibold hover:bg-white/90 transition-all duration-200 border border-white/20"},"Clear Search"))):e.createElement(e.Fragment,null,e.createElement("div",{className:"flex items-center justify-between mb-6"},e.createElement("div",{className:"flex items-center space-x-4"},e.createElement("h2",{className:"text-lg font-semibold text-iosGray-900"},c.length," ",c.length===1?"Community":"Communities"),r.trim()&&e.createElement("div",{className:"px-3 py-1 bg-iosBlue/10 text-iosBlue rounded-full text-sm font-medium"},'"',r,'"')),e.createElement("div",{className:"flex items-center space-x-2"},r.trim()&&e.createElement("button",{onClick:()=>G(""),className:"p-2 text-iosGray-600 hover:bg-white/40 rounded-xl transition-colors duration-200",title:"Clear search"},"✕"),e.createElement("button",{onClick:o,className:"p-2 text-iosGray-600 hover:bg-white/40 rounded-xl transition-colors duration-200",title:"Refresh"},"🔄"))),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},c.map((t,a)=>e.createElement("div",{key:t.id,className:"animate-fade-in",style:{animationDelay:`${a*.1}s`}},e.createElement(D,{community:t,userLocation:$,onJoinStatusChange:i})))),c.length>=20&&e.createElement("div",{className:"text-center mt-8"},e.createElement("button",{className:"px-6 py-3 bg-white/70 backdrop-blur-md text-iosGray-700 rounded-xl font-semibold hover:bg-white/90 transition-all duration-200 border border-white/20"},"Load More Communities")))),e.createElement("div",{className:"mt-12 animate-slide-up",style:{animationDelay:"0.2s"}},e.createElement("div",{className:"bg-white/70 backdrop-blur-md rounded-2xl border border-white/20 shadow-glass-sm p-6"},e.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 text-center"},e.createElement("div",null,e.createElement("div",{className:"text-2xl font-bold text-iosBlue mb-1"},p.length),e.createElement("div",{className:"text-sm text-iosGray-600"},"Total Communities")),e.createElement("div",null,e.createElement("div",{className:"text-2xl font-bold text-iosGreen mb-1"},p.filter(t=>t.type==="location_bound").length),e.createElement("div",{className:"text-sm text-iosGray-600"},"Location-Based")),e.createElement("div",null,e.createElement("div",{className:"text-2xl font-bold text-iosPurple mb-1"},p.filter(t=>t.type==="agnostic").length),e.createElement("div",{className:"text-sm text-iosGray-600"},"Global Communities")),e.createElement("div",null,e.createElement("div",{className:"text-2xl font-bold text-iosOrange mb-1"},w.size),e.createElement("div",{className:"text-sm text-iosGray-600"},"Your Communities")))))))};export{O as default};
