import{u as k,a as P,c as T,r as c,R as e}from"./index-C8OgQ19d.js";const F=()=>{const{user:b,getAuthHeader:y}=k(),d=P(),{communityId:m}=T(),[s,E]=c.useState(null),[r,p]=c.useState({title:"",content:"",type:"text",url:"",tags:[]}),[f,x]=c.useState(""),[l,i]=c.useState(!1),[g,n]=c.useState("");if(!b)return d("/login"),null;c.useEffect(()=>{N()},[m]);const N=async()=>{try{const a=await(await fetch(`http://localhost:3001/api/communities/${m}`,{headers:{"Content-Type":"application/json",...y()}})).json();a.success?(E(a.data),a.data.user_role||n("You must be a member of the community to create posts")):n(a.error||"Community not found")}catch(t){console.error("Error fetching community:",t),n("Failed to load community")}},u=t=>{const{name:a,value:o}=t.target;p(C=>({...C,[a]:o})),g&&n("")},h=()=>{const t=f.trim().toLowerCase();t&&!r.tags.includes(t)&&(p(a=>({...a,tags:[...a.tags,t]})),x(""))},v=t=>{p(a=>({...a,tags:a.tags.filter(o=>o!==t)}))},w=async t=>{if(t.preventDefault(),i(!0),n(""),!r.title.trim()){n("Post title is required"),i(!1);return}if(!r.content.trim()){n("Post content is required"),i(!1);return}if(r.type==="link"&&!r.url.trim()){n("URL is required for link posts"),i(!1);return}try{const o=await(await fetch("http://localhost:3001/api/posts",{method:"POST",headers:{"Content-Type":"application/json",...y()},body:JSON.stringify({title:r.title.trim(),content:r.content.trim(),author:b.id,community_id:parseInt(m),is_draft:!1})})).json();o.success||o.data?d(`/communities/${m}`):n(o.error||"Failed to create post")}catch(a){console.error("Error creating post:",a),n("Failed to create post. Please try again.")}finally{i(!1)}};return s?e.createElement("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 p-6"},e.createElement("div",{className:"max-w-2xl mx-auto"},e.createElement("div",{className:"bg-white rounded-lg shadow-md p-8"},e.createElement("div",{className:"mb-6"},e.createElement("h1",{className:"text-3xl font-bold text-gray-900 mb-2"},"Create Post"),e.createElement("p",{className:"text-gray-600"},"Posting in ",e.createElement("strong",null,s.name))),g&&e.createElement("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6"},g),e.createElement("form",{onSubmit:w,className:"space-y-6"},e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-2"},"Post Type"),e.createElement("div",{className:"flex space-x-4"},e.createElement("label",{className:"flex items-center"},e.createElement("input",{type:"radio",name:"type",value:"text",checked:r.type==="text",onChange:u,className:"mr-2",disabled:l}),e.createElement("span",{className:"text-sm"},"ðŸ“ Text Post")),e.createElement("label",{className:"flex items-center"},e.createElement("input",{type:"radio",name:"type",value:"link",checked:r.type==="link",onChange:u,className:"mr-2",disabled:l}),e.createElement("span",{className:"text-sm"},"ðŸ”— Link Post")))),e.createElement("div",null,e.createElement("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-2"},"Title *"),e.createElement("input",{type:"text",id:"title",name:"title",value:r.title,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Enter your post title",required:!0,disabled:l})),r.type==="link"&&e.createElement("div",null,e.createElement("label",{htmlFor:"url",className:"block text-sm font-medium text-gray-700 mb-2"},"URL *"),e.createElement("input",{type:"url",id:"url",name:"url",value:r.url,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"https://example.com",required:!0,disabled:l})),e.createElement("div",null,e.createElement("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700 mb-2"},"Content *"),e.createElement("textarea",{id:"content",name:"content",value:r.content,onChange:u,rows:8,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:r.type==="link"?"Describe why you're sharing this link...":"Write your post content...",required:!0,disabled:l})),e.createElement("div",null,e.createElement("label",{htmlFor:"tagInput",className:"block text-sm font-medium text-gray-700 mb-2"},"Tags (Optional)"),e.createElement("div",{className:"flex space-x-2 mb-2"},e.createElement("input",{type:"text",id:"tagInput",value:f,onChange:t=>x(t.target.value),onKeyPress:t=>t.key==="Enter"&&(t.preventDefault(),h()),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Add tags to help categorize your post",disabled:l}),e.createElement("button",{type:"button",onClick:h,disabled:l,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 transition-colors"},"Add")),r.tags.length>0&&e.createElement("div",{className:"flex flex-wrap gap-2"},r.tags.map((t,a)=>e.createElement("span",{key:a,className:"inline-flex items-center px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm"},"#",t,e.createElement("button",{type:"button",onClick:()=>v(t),disabled:l,className:"ml-2 text-purple-600 hover:text-purple-800"},"Ã—"))))),s.rules&&s.rules.length>0&&e.createElement("div",{className:"bg-blue-50 p-4 rounded-lg"},e.createElement("h4",{className:"text-sm font-medium text-blue-900 mb-2"},"Community Rules"),e.createElement("ul",{className:"text-sm text-blue-800 space-y-1"},s.rules.slice(0,3).map((t,a)=>e.createElement("li",{key:a},"â€¢ ",t)),s.rules.length>3&&e.createElement("li",{className:"text-blue-600"},"â€¢ ... and ",s.rules.length-3," more"))),e.createElement("div",{className:"flex items-center justify-between pt-6 border-t border-gray-200"},e.createElement("button",{type:"button",onClick:()=>d(`/communities/${m}`),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",disabled:l},"Cancel"),e.createElement("div",{className:"flex space-x-3"},e.createElement("button",{type:"submit",disabled:l,className:"px-8 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},l?"Publishing...":"Publish Post"))))))):e.createElement("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 p-6"},e.createElement("div",{className:"max-w-2xl mx-auto"},e.createElement("div",{className:"bg-white rounded-lg shadow-md p-8"},e.createElement("div",{className:"animate-pulse"},e.createElement("div",{className:"h-8 bg-gray-300 rounded w-1/3 mb-4"}),e.createElement("div",{className:"h-4 bg-gray-300 rounded w-2/3 mb-6"})))))};export{F as default};
