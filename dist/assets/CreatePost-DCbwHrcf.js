import{a as L,u as T,r as P,R as e,b as j,B as l}from"./index-C8OgQ19d.js";import{u as q,a as z}from"./useApi-CDCt5oBc.js";import{u as A}from"./useForm-v0luTp9G.js";const U=()=>{const s=L(),{user:r,isAuthenticated:x}=T(),[o,E]=P.useState(!1),[v,h]=P.useState("");e.useEffect(()=>{x||s("/login")},[x,s]);const C={title:{required:"Title is required",minLength:5,maxLength:200},content:{required:"Content is required",minLength:10}},{values:t,errors:c,touched:N,getFieldProps:i,isValid:f}=A({title:"",content:"",category:"",tags:""},C),{execute:S,loading:m}=q(),{saveDraft:k,loading:u}=z(r==null?void 0:r.id),d=i("title"),p=i("content"),g=i("category"),b=i("tags"),w=async a=>{try{const n=await S({title:a.title,content:a.content,author:r.id,is_draft:!1});n.success?(l.success("Post published successfully!"),s(`/post/${n.data.data.id}`)):l.error(n.error||"Failed to publish post")}catch(n){l.error("Error publishing post"),console.error("Error creating post:",n)}},y=async()=>{if(!t.title&&!t.content){l.warning("Please add some content before saving draft");return}try{const a=await k({title:t.title||"Untitled Draft",content:t.content||"",author:r.id});a.success?(l.success("Draft saved successfully!"),h("Saved")):l.error(a.error||"Failed to save draft")}catch(a){l.error("Error saving draft"),console.error("Error saving draft:",a)}};e.useEffect(()=>{if(t.title||t.content){const a=setTimeout(()=>{h("Auto-saving..."),y()},5e3);return()=>clearTimeout(a)}},[t.title,t.content]);const B=async a=>{a.preventDefault(),f()&&await w(t)},D=a=>a.split(`
`).map((n,F)=>e.createElement("p",{key:F,className:"mb-2"},n));return x?e.createElement("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100"},e.createElement("nav",{className:"fixed top-0 left-0 right-0 z-50 bg-white/80 backdrop-blur-xl border-b border-white/20"},e.createElement("div",{className:"max-w-4xl mx-auto px-4 py-3"},e.createElement("div",{className:"flex items-center justify-between"},e.createElement("button",{onClick:()=>s(-1),className:"flex items-center space-x-2 px-4 py-2 rounded-full bg-gradient-to-r from-purple-400/20 to-blue-400/20 hover:scale-105 transition-all duration-200"},e.createElement("span",null,"←"),e.createElement("span",{className:"font-medium text-gray-900"},"Back")),e.createElement("div",{className:"flex items-center space-x-4"},v&&e.createElement("span",{className:"text-sm text-gray-600"},v),e.createElement("button",{onClick:()=>E(!o),className:"flex items-center space-x-2 px-4 py-2 rounded-full bg-gradient-to-r from-blue-400/20 to-green-400/20 hover:scale-105 transition-all duration-200"},e.createElement("span",null,o?"📝":"👁️"),e.createElement("span",{className:"font-medium text-gray-900"},o?"Edit":"Preview")))))),e.createElement("main",{className:"pt-20 pb-24 px-4 max-w-4xl mx-auto"},e.createElement("div",{className:"glass-card rounded-2xl p-6 animate-glass-fade-in"},e.createElement("h1",{className:"text-3xl font-bold text-gray-900 mb-6"},o?"Preview Post":"Create New Post"),o?e.createElement("div",{className:"space-y-6"},e.createElement("div",{className:"border-b border-gray-200 pb-4"},e.createElement("h2",{className:"text-2xl font-bold text-gray-900 mb-2"},t.title||"Untitled Post"),e.createElement("div",{className:"flex items-center space-x-4 text-sm text-gray-600"},e.createElement("span",null,"By ",r==null?void 0:r.username),e.createElement("span",null,"•"),e.createElement("span",null,"Just now"),t.category&&e.createElement(e.Fragment,null,e.createElement("span",null,"•"),e.createElement("span",{className:"capitalize"},t.category)))),e.createElement("div",{className:"prose prose-lg max-w-none"},t.content?e.createElement("div",{className:"text-gray-800 leading-relaxed"},D(t.content)):e.createElement("p",{className:"text-gray-500 italic"},"No content to preview")),t.tags&&e.createElement("div",{className:"flex flex-wrap gap-2 pt-4 border-t border-gray-200"},t.tags.split(",").map((a,n)=>e.createElement("span",{key:n,className:"px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm"},a.trim()))),e.createElement("div",{className:"flex items-center justify-between pt-6 border-t border-gray-200"},e.createElement("button",{onClick:y,disabled:u,className:"btn-secondary px-6 py-3 disabled:opacity-50"},u?"Saving...":"Save Draft"),e.createElement("div",{className:"flex items-center space-x-4"},e.createElement("button",{onClick:()=>E(!1),className:"text-gray-600 hover:text-gray-800 font-medium"},"Back to Edit"),e.createElement("button",{onClick:()=>w(t),disabled:!f||m||!t.title.trim()||!t.content.trim(),className:"btn-primary px-8 py-3 disabled:opacity-50"},m?"Publishing...":"Publish Post")))):e.createElement("form",{onSubmit:B,className:"space-y-6"},e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-gray-900 mb-2"},"Title *"),e.createElement("input",{name:d.name,value:d.value,onChange:d.onChange,onBlur:d.onBlur,type:"text",placeholder:"Enter your post title...",className:"w-full px-4 py-3 rounded-xl bg-white/50 border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-400/20 outline-none transition-all duration-200"}),N.title&&c.title&&e.createElement("p",{className:"mt-1 text-sm text-red-600"},c.title)),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-gray-900 mb-2"},"Content *"),e.createElement("textarea",{name:p.name,value:p.value,onChange:p.onChange,onBlur:p.onBlur,placeholder:"Share your thoughts...",rows:"12",className:"w-full px-4 py-3 rounded-xl bg-white/50 border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-400/20 outline-none transition-all duration-200 resize-none"}),N.content&&c.content&&e.createElement("p",{className:"mt-1 text-sm text-red-600"},c.content)),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-gray-900 mb-2"},"Category"),e.createElement("select",{name:g.name,value:g.value,onChange:g.onChange,onBlur:g.onBlur,className:"w-full px-4 py-3 rounded-xl bg-white/50 border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-400/20 outline-none transition-all duration-200"},e.createElement("option",{value:""},"Select a category..."),e.createElement("option",{value:"general"},"General"),e.createElement("option",{value:"programming"},"Programming"),e.createElement("option",{value:"design"},"Design"),e.createElement("option",{value:"gaming"},"Gaming"),e.createElement("option",{value:"science"},"Science"),e.createElement("option",{value:"technology"},"Technology"))),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-gray-900 mb-2"},"Tags"),e.createElement("input",{name:b.name,value:b.value,onChange:b.onChange,onBlur:b.onBlur,type:"text",placeholder:"Enter tags separated by commas...",className:"w-full px-4 py-3 rounded-xl bg-white/50 border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-400/20 outline-none transition-all duration-200"}),e.createElement("p",{className:"mt-1 text-xs text-gray-600"},"Separate tags with commas (e.g., react, javascript, tutorial)")),e.createElement("div",{className:"flex items-center justify-between pt-6"},e.createElement("button",{type:"button",onClick:y,disabled:u||!t.title&&!t.content,className:"btn-secondary px-6 py-3 disabled:opacity-50"},u?"Saving...":"Save Draft"),e.createElement("div",{className:"flex items-center space-x-4"},e.createElement("button",{type:"button",onClick:()=>s("/"),className:"text-gray-600 hover:text-gray-800 font-medium"},"Cancel"),e.createElement("button",{type:"submit",disabled:!f||m||!t.title.trim()||!t.content.trim(),className:"btn-primary px-8 py-3 disabled:opacity-50"},m?"Publishing...":"Publish Post"))))))):e.createElement("div",{className:"min-h-screen pt-20 flex items-center justify-center"},e.createElement(j,{size:"lg",text:"Checking authentication..."}))};export{U as default};
